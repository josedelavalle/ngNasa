var app=angular.module("myApp",["ngRoute","ngAnimate","ngAria","ngMessages","ngMaterial","angularMoment","ngMap"]);app.config(["$routeProvider","$locationProvider","$mdDateLocaleProvider",function(e,t,n){n.formatDate=function(e){return moment(e).format("YYYY-MM-DD")},t.html5Mode(!0),e.when("/",{templateUrl:"views/home.html"}).otherwise({redirectTo:"/"})}]),app.factory("ngNasaFactory",function(e){return apikey="sFBD6hSaJ9HBP6U8qhXaBv6v9pKcTYtICStGJlOA",{getPicOfTheDay:function(t){return e.get("https://api.nasa.gov/planetary/apod?date="+t+"&api_key="+apikey)},getSounds:function(){return e.get("https://api.nasa.gov/planetary/sounds?q=apollo&api_key=sFBD6hSaJ9HBP6U8qhXaBv6v9pKcTYtICStGJlOA")},getEpic:function(){var t="https://epic.gsfc.nasa.gov/api/images.php";return e.get(t)},getMars:function(t,n){console.log(t,n);var a="https://api.nasa.gov/mars-photos/api/v1/rovers/"+n+"/photos?earth_date="+t+"&api_key="+apikey;return console.log(a),e.get(a)},getImagery:function(t,n,a){var o="https://api.nasa.gov/planetary/earth/imagery?lon="+n+"&lat="+t+"&date="+a+"&cloud_score=True&api_key="+apikey;return console.log(o),e.get(o)},getCoordinates:function(t){return e.get(encodeURI("http://maps.googleapis.com/maps/api/geocode/json?address="+t))}}}),app.controller("appController",["$scope","$filter","ngNasaFactory","geolocationSvc","NgMap",function(e,t,n,a,o){function i(e){return t("date")(e,"yyyy-MM-dd")}function r(t){e.showSpinner=!0,n.getPicOfTheDay(t).then(function(t){e.data=t.data,console.log("got pic of the day",t),"video"==e.data.media_type&&(e.data.title="Video Support Coming Soon"),e.showSpinner=!1},function(n){e.data={title:n.data.msg,copyright:"Code: "+n.data.code,date:t,explanation:"NASA Pic of the Day unavailable for this date",url:defaultPicture},e.showSpinner=!1})}e.title=i(new Date),e.path="/",notToday=!1,defaultPicture="images/earth2.jpg",e.todayDate=e.title,e.currentDate=new Date;var c="curiosity";e.initDatepicker=function(){angular.element(".md-datepicker-button").each(function(){var e=this;angular.element(e).parent().find("input").bind("click",function(t){angular.element(e).click()});angular.element(this).css("visibility","hidden")})},e.dateChanged=function(){e.myDate=i(this.myDate),e.currentDate=this.myDate,e.title=e.myDate,checkToday(),r(e.title),s(c)},checkToday=function(){e.title!=e.todayDate?notToday=!0:notToday=!1},e.myDate=new Date,e.minDate=new Date(e.myDate.getFullYear(),e.myDate.getMonth()-2,e.myDate.getDate()),e.maxDate=new Date(e.myDate.getFullYear(),e.myDate.getMonth(),e.myDate.getDate()),e.onlyWeekendsPredicate=function(e){var t=e.getDay();return 0===t||6===t},e.pageTitle="Picture of the Day",e.headerTitle="Jose DeLavalle",e.defaultSearch="New York",e.rotate=!0,e.rotateIcon=function(){e.rotate=!e.rotate},e.goBack=function(t){t||(t=1),e.currentDate.setDate(e.currentDate.getDate()-t),e.title=i(e.currentDate),e.myDate=e.currentDate,checkToday(),r(e.title),s(c)},e.goForward=function(){notToday&&(e.currentDate.setDate(e.currentDate.getDate()+1),e.title=i(e.currentDate),e.myDate=e.currentDate,checkToday(),r(e.title),s(c))},r(e.title);var s=function(t){c=t,console.log("getting mars images",t),e.showSpinner=!0,e.mars=null,n.getMars(i(e.myDate),t).then(function(t){console.log("got mars",t),e.mars=t.data.photos,e.showSpinner=!1}).catch(function(t){console.log("error getting mars data",t),e.mars={},e.showSpinner=!1})};e.goGetMars=s,e.goGetCoordinates=function(t){e.showSpinner=!0,n.getCoordinates(t).then(function(t){console.log(t),t.data.results.length>0?(e.coordinates=t.data.results[0].geometry.location,console.log(e.coordinates),n.getImagery(e.coordinates.lat,e.coordinates.lng,e.title).then(function(t){console.log(t),t.data.error?e.imagery={url:"https://maps.googleapis.com/maps/api/staticmap?maptype=satellite&center="+e.coordinates.lat+","+e.coordinates.lng+"&zoom=11&size=400x400&key=AIzaSyBy34i8mK7IXxcAqmZfOEX70XZtNEt7D7s"}:e.imagery=t.data,e.showSpinner=!1})):(e.showSpinner=!1,e.imagery=null)})},e.getUserLocation=function(){e.showSpinner=!0,a.getCurrentPosition().then(function(t){console.log(t),e.coordinates={lat:t.coords.latitude,lng:t.coords.longitude},n.getImagery(e.coordinates.lat,e.coordinates.lng,e.title).then(function(t){e.imagery=t.data,e.showSpinner=!1},function(t){e.imagery={date:t},e.showSpinner=!1})},function(t){console.log(t.message),e.imagery={date:t.message},e.showSpinner=!1})}}]),app.factory("geolocationSvc",["$q","$window",function(e,t){"use strict";function n(){var n=e.defer();return t.navigator.geolocation?t.navigator.geolocation.getCurrentPosition(function(e){n.resolve(e)},function(e){console.log(e),n.reject(e)}):n.reject("Geolocation not supported."),n.promise}return{getCurrentPosition:n}}]),app.directive("slideable",function(){return{restrict:"C",compile:function(e,t){var n=e.html();return e.html('<div class="slideable_content" style="margin:0 !important; padding:0 !important" >'+n+"</div>"),function(e,t,n){n.duration=n.duration?n.duration:"1s",n.easing=n.easing?n.easing:"ease-in-out";var a="0px";if(!n.showonload){var o=content.clientHeight;a=o+"px"}t.css({overflow:"hidden",height:a,transitionProperty:"height",transitionDuration:n.duration,transitionTimingFunction:n.easing,background:"rgba(0, 0, 0, 0)"})}}}}),app.directive("slideToggle",function(){return{restrict:"A",link:function(e,t,n){var a,o;n.expanded="true"===n.expanded,t.bind("click",function(e){if(n.slideToggle?a||(a=document.querySelector(n.slideToggle)):a||(a=$(this).parent().find(".slideable")[0]),o||(o=a.querySelector(".slideable_content")),n.expanded)a.style.height="0px";else{o.style.border="1px solid rgba(0,0,0,0)";var t=o.clientHeight;o.style.border=0,a.style.height=t+"px"}n.expanded=!n.expanded})}}}),app.directive("myEnter",function(){return function(e,t,n){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(n.myEnter)}),t.preventDefault())})}});